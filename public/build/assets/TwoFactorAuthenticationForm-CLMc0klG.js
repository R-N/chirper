var q=Object.defineProperty;var x=(e,o,t)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var m=(e,o,t)=>x(e,typeof o!="symbol"?o+"":o,t);import{d as S,J as L,o as r,e as i,a as c,r as D,b as d,w as s,g as l,t as A,I as $,n as _,q as M,z as N,C as O,i as h,j as g,c as b,f,F as H,h as Q}from"./app-DCXzMWXa.js";import{b as j,a as U}from"./DialogModal-CJzMldpY.js";import{_ as B}from"./InputError-BJCQ_2OS.js";import{_ as E}from"./PrimaryButton-CoZ8PQbO.js";import{_ as K}from"./SecondaryButton-ATj6J-qY.js";import{_ as V}from"./TextInput-CoUy5fzm.js";import{_ as W}from"./DangerButton-DmA2sjPQ.js";import{_ as Y}from"./InputLabel-rm7JmSlO.js";import{t as z,d as G,b as J,C as X,V as Z}from"./index-CSEC8W1N.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./SectionTitle-Da4cl8iM.js";const oe={class:"mt-4"},te={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(e,{emit:o}){const t=o,a=S(!1),n=L({password:"",error:"",processing:!1}),p=S(null),w=()=>{axios.get(route("password.confirmation")).then(y=>{y.data.confirmed?t("confirmed"):(a.value=!0,setTimeout(()=>p.value.focus(),250))})},F=()=>{n.processing=!0,axios.post(route("password.confirm"),{password:n.password}).then(()=>{n.processing=!1,C(),M().then(()=>t("confirmed"))}).catch(y=>{n.processing=!1,n.error=y.response.data.errors.password[0],p.value.focus()})},C=()=>{a.value=!1,n.password="",n.error=""};return(y,u)=>(r(),i("span",null,[c("span",{onClick:w},[D(y.$slots,"default")]),d(j,{show:a.value,onClose:C},{title:s(()=>[l(A(e.title),1)]),content:s(()=>[l(A(e.content)+" ",1),c("div",oe,[d(V,{ref_key:"passwordInput",ref:p,modelValue:n.password,"onUpdate:modelValue":u[0]||(u[0]=v=>n.password=v),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",autocomplete:"current-password",onKeyup:$(F,["enter"])},null,8,["modelValue"]),d(B,{message:n.error,class:"mt-2"},null,8,["message"])])]),footer:s(()=>[d(K,{onClick:C},{default:s(()=>u[1]||(u[1]=[l(" Cancel ")])),_:1}),d(E,{class:_(["ms-3",{"opacity-25":n.processing}]),disabled:n.processing,onClick:F},{default:s(()=>[l(A(e.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}};var ne=Object.defineProperty,re=Object.getOwnPropertyDescriptor,P=(e,o,t,a)=>{for(var n=a>1?void 0:a?re(o,t):o,p=e.length-1,w;p>=0;p--)(w=e[p])&&(n=(a?w(o,t,n):w(n))||n);return a&&n&&ne(o,t,n),n};let k=class extends Z{constructor(){super(...arguments);m(this,"requiresConfirmation");m(this,"page",N());m(this,"enabling",!1);m(this,"confirming",!1);m(this,"disabling",!1);m(this,"qrCode",null);m(this,"setupKey",null);m(this,"recoveryCodes",[]);m(this,"confirmationForm",O({code:""}))}get twoFactorEnabled(){var t;return!this.enabling&&((t=this.page.props.auth.user)==null?void 0:t.two_factor_enabled)}twoFactorEnabledWatcher(t,a){t||(this.confirmationForm.reset(),this.confirmationForm.clearErrors())}async enableTwoFactorAuthentication(){this.enabling.value=!0;try{let t=await h.post(route("two-factor.enable"));await this.showQrCode(),await this.showSetupKey(),await this.showRecoveryCodes()}finally{this.enabling=!1,this.confirming=this.requiresConfirmation}}async showQrCode(){return await h.get(route("two-factor.qr-code")).then(t=>{this.qrCode=t.data.svg})}async showSetupKey(){return await h.get(route("two-factor.secret-key")).then(t=>{this.setupKey=t.data.secretKey})}async showRecoveryCodes(){return await h.get(route("two-factor.recovery-codes")).then(t=>{this.recoveryCodes=t.data})}async confirmTwoFactorAuthentication(){var t;try{let a=await h.post(route("two-factor.confirm"),this.confirmationForm);this.confirming=!1,this.qrCode=null,this.setupKey=null}catch(a){((t=a.response)==null?void 0:t.status)===422?this.confirmationForm.errors=a.response.data.errors:console.error("Unexpected error:",a)}}async regenerateRecoveryCodes(){await h.post(route("two-factor.confirm")),this.showRecoveryCodes()}async disableTwoFactorAuthentication(){this.disabling=!0,await h.delete(route("two-factor.disable")),this.disabling=!1,this.confirming=!1}};P([G(Boolean)],k.prototype,"requiresConfirmation",2);P([J("twoFactorEnabled")],k.prototype,"twoFactorEnabledWatcher",1);k=P([X({components:{ActionSection:U,ConfirmsPassword:te,DangerButton:W,InputError:B,InputLabel:Y,PrimaryButton:E,SecondaryButton:K,TextInput:V}})],k);const se=z(k),ae={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ie={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},de={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},le={key:3},ce={key:0},ue={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},me={key:0,class:"font-semibold"},fe={key:1},pe=["innerHTML"],ye={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ge={class:"font-semibold"},we=["innerHTML"],he={key:1,class:"mt-4"},be={key:1},Ce={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-100 rounded-lg"},ve={class:"mt-5"},_e={key:0},ke={key:1};function Fe(e,o,t,a,n,p){const w=g("InputLabel"),F=g("TextInput"),C=g("InputError"),y=g("PrimaryButton"),u=g("ConfirmsPassword"),v=g("SecondaryButton"),I=g("DangerButton"),R=g("ActionSection");return r(),b(R,null,{title:s(()=>o[1]||(o[1]=[l(" Two Factor Authentication ")])),description:s(()=>o[2]||(o[2]=[l(" Add additional security to your account using two factor authentication. ")])),content:s(()=>[e.twoFactorEnabled&&!e.confirming?(r(),i("h3",ae," You have enabled two factor authentication. ")):e.twoFactorEnabled&&e.confirming?(r(),i("h3",ie," Finish enabling two factor authentication. ")):(r(),i("h3",de," You have not enabled two factor authentication. ")),o[11]||(o[11]=c("div",{class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[c("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),e.twoFactorEnabled?(r(),i("div",le,[e.qrCode?(r(),i("div",ce,[c("div",ue,[e.confirming?(r(),i("p",me," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(r(),i("p",fe," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),c("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:e.qrCode},null,8,pe),e.setupKey?(r(),i("div",ye,[c("p",ge,[o[3]||(o[3]=l(" Setup Key: ")),c("span",{innerHTML:e.setupKey},null,8,we)])])):f("",!0),e.confirming?(r(),i("div",he,[d(w,{for:"code",value:"Code"}),d(F,{id:"code",modelValue:e.confirmationForm.code,"onUpdate:modelValue":o[0]||(o[0]=T=>e.confirmationForm.code=T),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:$(e.confirmTwoFactorAuthentication,["enter"])},null,8,["modelValue","onKeyup"]),d(C,{message:e.confirmationForm.errors.code,class:"mt-2"},null,8,["message"])])):f("",!0)])):f("",!0),e.recoveryCodes.length>0&&!e.confirming?(r(),i("div",be,[o[4]||(o[4]=c("div",{class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},[c("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),c("div",Ce,[(r(!0),i(H,null,Q(e.recoveryCodes,T=>(r(),i("div",{key:T},A(T),1))),128))])])):f("",!0)])):f("",!0),c("div",ve,[e.twoFactorEnabled?(r(),i("div",ke,[d(u,{onConfirmed:e.confirmTwoFactorAuthentication},{default:s(()=>[e.confirming?(r(),b(y,{key:0,type:"button",class:_(["me-3",{"opacity-25":e.enabling}]),disabled:e.enabling},{default:s(()=>o[6]||(o[6]=[l(" Confirm ")])),_:1},8,["class","disabled"])):f("",!0)]),_:1},8,["onConfirmed"]),d(u,{onConfirmed:e.regenerateRecoveryCodes},{default:s(()=>[e.recoveryCodes.length>0&&!e.confirming?(r(),b(v,{key:0,class:"me-3"},{default:s(()=>o[7]||(o[7]=[l(" Regenerate Recovery Codes ")])),_:1})):f("",!0)]),_:1},8,["onConfirmed"]),d(u,{onConfirmed:e.showRecoveryCodes},{default:s(()=>[e.recoveryCodes.length===0&&!e.confirming?(r(),b(v,{key:0,class:"me-3"},{default:s(()=>o[8]||(o[8]=[l(" Show Recovery Codes ")])),_:1})):f("",!0)]),_:1},8,["onConfirmed"]),d(u,{onConfirmed:e.disableTwoFactorAuthentication},{default:s(()=>[e.confirming?(r(),b(v,{key:0,class:_({"opacity-25":e.disabling}),disabled:e.disabling},{default:s(()=>o[9]||(o[9]=[l(" Cancel ")])),_:1},8,["class","disabled"])):f("",!0)]),_:1},8,["onConfirmed"]),d(u,{onConfirmed:e.disableTwoFactorAuthentication},{default:s(()=>[e.confirming?f("",!0):(r(),b(I,{key:0,class:_({"opacity-25":e.disabling}),disabled:e.disabling},{default:s(()=>o[10]||(o[10]=[l(" Disable ")])),_:1},8,["class","disabled"]))]),_:1},8,["onConfirmed"])])):(r(),i("div",_e,[d(u,{onConfirmed:e.enableTwoFactorAuthentication},{default:s(()=>[d(y,{type:"button",class:_({"opacity-25":e.enabling}),disabled:e.enabling},{default:s(()=>o[5]||(o[5]=[l(" Enable ")])),_:1},8,["class","disabled"])]),_:1},8,["onConfirmed"])]))])]),_:1})}const Le=ee(se,[["render",Fe]]);export{Le as default};
