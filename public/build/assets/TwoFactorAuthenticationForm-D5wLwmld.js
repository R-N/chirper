var W=Object.defineProperty;var Y=(e,o,t)=>o in e?W(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var l=(e,o,t)=>Y(e,typeof o!="symbol"?o+"":o,t);import{C as q,z as K,o as n,B as y,a as w,ad as G,b as i,w as r,E as c,H as g,aw as I,D as p,ax as z,A as S,c as u,G as J,F as E}from"./app-DrYLPU_X.js";import{V as D,A as X}from"./ActionSection-45LSTfNX.js";import{C as O,t as B,V as M,d as k,b as Z,a as m,_ as N,c as _}from"./_plugin-vue_export-helper-BUg55JK2.js";import{V as v,a as j,b as C,c as Q}from"./VCard-Dz8tKv04.js";import{V as $}from"./VTextField-GCQIZL8v.js";import{I as x}from"./InputError-Bwl4ZAo1.js";import{p as ee}from"./profile-Cnk1t6Cc.js";import{V as U,a as H}from"./VRow-DvkPIYWF.js";import{V as P}from"./VField-C66dwn1o.js";import"./VOverlay-p4zMJbXj.js";import"./forwardRefs-DiIHdaJ1.js";import"./VAvatar-CGwUysPS.js";import"./SectionTitle-C2PNohfj.js";import"./VContainer-eLTv4ox0.js";/* empty css              */var oe=Object.defineProperty,te=Object.getOwnPropertyDescriptor,V=(e,o,t,s)=>{for(var a=s>1?void 0:s?te(o,t):o,f=e.length-1,d;f>=0;f--)(d=e[f])&&(a=(s?d(o,t,a):d(a))||a);return s&&a&&oe(o,t,a),a};let h=class extends M{constructor(){super(...arguments);l(this,"title");l(this,"content");l(this,"button");l(this,"confirmingPassword",!1);l(this,"form",q({password:"",error:"",processing:!1}));l(this,"passwordInput")}async startConfirmingPassword(){(await K.get(route("password.confirmation"))).data.confirmed?this.$emit("confirmed"):(this.confirmingPassword=!0,setTimeout(()=>{var t;return(t=this.passwordInput)==null?void 0:t.focus()},250))}async confirmPassword(){this.form.processing=!0;try{await K.post(route("password.confirm"),{password:this.form.password}),this.form.processing=!1,this.closeModal(),this.$nextTick(()=>this.$emit("confirmed"))}catch(o){this.form.processing=!1,this.form.error=o.response.data.errors.password[0],this.passwordInput.focus()}}closeModal(){this.confirmingPassword=!1,this.form.password="",this.form.error=""}};V([k({type:String,default:"Confirm Password"})],h.prototype,"title",2);V([k({type:String,default:"For your security, please confirm your password to continue."})],h.prototype,"content",2);V([k({type:String,default:"Confirm"})],h.prototype,"button",2);V([Z("passwordInput")],h.prototype,"passwordInput",2);h=V([O({components:{VDialog:D,VCard:v,VCardTitle:j,VCardText:C,VCardActions:Q,VTextField:$,VBtn:m}})],h);const re=B(h),se={key:0,class:"text-error mt-2"};function ae(e,o,t,s,a,f){return n(),y("span",null,[w("span",{onClick:o[0]||(o[0]=(...d)=>e.startConfirmingPassword&&e.startConfirmingPassword(...d))},[G(e.$slots,"default")]),i(D,{modelValue:e.confirmingPassword,"onUpdate:modelValue":o[2]||(o[2]=d=>e.confirmingPassword=d),persistent:"","max-width":"400px"},{default:r(()=>[i(v,null,{default:r(()=>[i(j,null,{default:r(()=>[c(g(e.title),1)]),_:1}),i(C,null,{default:r(()=>[c(g(e.content)+" ",1),i($,{ref:"passwordInput",modelValue:e.form.password,"onUpdate:modelValue":o[1]||(o[1]=d=>e.form.password=d),type:"password",class:"mt-4",placeholder:"Password",autocomplete:"current-password",onKeyup:I(e.confirmPassword,["enter"]),variant:"outlined"},null,8,["modelValue","onKeyup"]),e.form.error?(n(),y("p",se,g(e.form.error),1)):p("",!0)]),_:1}),i(Q,null,{default:r(()=>[i(m,{variant:"text",onClick:e.closeModal},{default:r(()=>o[3]||(o[3]=[c("Cancel")])),_:1},8,["onClick"]),i(m,{color:"primary",variant:"elevated",loading:e.form.processing,onClick:e.confirmPassword},{default:r(()=>[c(g(e.button),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ne=N(re,[["render",ae]]);class ie{constructor(o){this.axios=o||K}async enableTwoFactorAuthentication(){let o=await this.axios.post(route("two-factor.enable")),t=await this.showQrCode(),s=await this.showSetupKey(),a=await this.showRecoveryCodes();return{...o.data,qrCode:t,setupKey:s,recoveryCodes:a}}async showQrCode(){return(await this.axios.get(route("two-factor.qr-code"))).data.svg}async showSetupKey(){return(await this.axios.get(route("two-factor.secret-key"))).data.secretKey}async showRecoveryCodes(){return(await this.axios.get(route("two-factor.recovery-codes"))).data}async confirmTwoFactorAuthentication(o){return(await this.axios.post(route("two-factor.confirm"),o)).data}async regenerateRecoveryCodes(){return await this.axios.post(route("two-factor.confirm")),this.showRecoveryCodes()}async disableTwoFactorAuthentication(){return(await this.axios.delete(route("two-factor.disable"))).data}}const A=new ie;var le=Object.defineProperty,de=Object.getOwnPropertyDescriptor,R=(e,o,t,s)=>{for(var a=s>1?void 0:s?de(o,t):o,f=e.length-1,d;f>=0;f--)(d=e[f])&&(a=(s?d(o,t,a):d(a))||a);return s&&a&&le(o,t,a),a};let F=class extends M{constructor(){super(...arguments);l(this,"requiresConfirmation");l(this,"page",z());l(this,"enabling",!1);l(this,"confirming",!1);l(this,"disabling",!1);l(this,"qrCode",null);l(this,"setupKey",null);l(this,"recoveryCodes",[]);l(this,"confirmationForm",q({code:""}))}get twoFactorEnabled(){var t;return!this.enabling&&((t=this.page.props.auth.user)==null?void 0:t.two_factor_enabled)}twoFactorEnabledWatcher(t,s){t||(this.confirmationForm.reset(),this.confirmationForm.clearErrors())}async enableTwoFactorAuthentication(){this.enabling=!0;try{let t=await A.enableTwoFactorAuthentication();this.qrCode=t.qrCode,this.setupKey=t.setupKey,this.recoveryCodes=t.recoveryCodes}finally{this.enabling=!1,this.confirming=this.requiresConfirmation}}async showRecoveryCodes(){let t=await ee.showRecoveryCodes();this.recoveryCodes=t.data}async confirmTwoFactorAuthentication(){var t;try{let s=await A.confirmTwoFactorAuthentication(this.confirmationForm);this.confirming=!1,this.qrCode=null,this.setupKey=null}catch(s){((t=s.response)==null?void 0:t.status)===422?this.confirmationForm.errors=s.response.data.errors:console.error("Unexpected error:",s)}}async regenerateRecoveryCodes(){await A.regenerateRecoveryCodes()}async disableTwoFactorAuthentication(){this.disabling=!0,await A.disableTwoFactorAuthentication(),this.disabling=!1,this.confirming=!1}};R([k(Boolean)],F.prototype,"requiresConfirmation",2);R([_("twoFactorEnabled")],F.prototype,"twoFactorEnabledWatcher",1);F=R([O({components:{ActionSection:X,InputError:x,ConfirmsPassword:ne,VRow:U,VCol:H,VTextField:$,VBtn:m,VAlert:P,VCard:v,VCardText:C}})],F);const ue=B(F),ce={key:0},fe={key:1},me=["innerHTML"],pe={class:"bg-gray-100 dark:bg-gray-900 rounded-lg pa-4"},we={class:"mt-5"};function ye(e,o,t,s,a,f){const d=S("InputError"),b=S("ConfirmsPassword"),L=S("ActionSection");return n(),u(L,null,{title:r(()=>o[1]||(o[1]=[c("Two Factor Authentication")])),description:r(()=>o[2]||(o[2]=[c("Add additional security to your account.")])),content:r(()=>[e.twoFactorEnabled&&!e.confirming?(n(),u(P,{key:0,type:"success",title:"You have enabled two-factor authentication."})):e.twoFactorEnabled&&e.confirming?(n(),u(P,{key:1,type:"info",title:"Finish enabling two-factor authentication."})):(n(),u(P,{key:2,type:"warning",title:"You have not enabled two-factor authentication."})),o[10]||(o[10]=w("p",{class:"text-body-1 mt-2 mb-2"}," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ",-1)),e.qrCode?(n(),u(v,{key:3,class:"mt-4 pa-4"},{default:r(()=>[i(C,null,{default:r(()=>[e.confirming?(n(),y("p",ce," To finish enabling two-factor authentication, scan the QR code using your authenticator app or enter the setup key. ")):(n(),y("p",fe,"Two-factor authentication is now enabled. Scan the QR code or enter the setup key."))]),_:1}),w("div",{class:"text-center",innerHTML:e.qrCode},null,8,me),e.setupKey?(n(),u(C,{key:0},{default:r(()=>[o[3]||(o[3]=w("strong",null,"Setup Key:",-1)),c(" "+g(e.setupKey),1)]),_:1})):p("",!0),e.confirming?(n(),u(U,{key:1,class:"mt-4"},{default:r(()=>[i(H,{cols:"12"},{default:r(()=>[i($,{modelValue:e.confirmationForm.code,"onUpdate:modelValue":o[0]||(o[0]=T=>e.confirmationForm.code=T),label:"Code",autofocus:"",onKeyup:I(e.confirmTwoFactorAuthentication,["enter"])},null,8,["modelValue","onKeyup"]),i(d,{message:e.confirmationForm.errors.code},null,8,["message"])]),_:1})]),_:1})):p("",!0)]),_:1})):p("",!0),e.recoveryCodes.length>0&&!e.confirming?(n(),u(v,{key:4,class:"mt-4 pa-4"},{default:r(()=>[i(C,null,{default:r(()=>[o[4]||(o[4]=w("p",null,"Store these recovery codes safely. They help regain access if you lose your authentication device.",-1)),w("div",pe,[(n(!0),y(E,null,J(e.recoveryCodes,T=>(n(),y("div",{key:T},g(T),1))),128))])]),_:1})]),_:1})):p("",!0),w("div",we,[e.twoFactorEnabled?(n(),y(E,{key:1},[e.confirming?(n(),u(b,{key:0,onConfirmed:e.confirmTwoFactorAuthentication},{default:r(()=>[i(m,{color:"primary",class:"me-3",disabled:e.enabling},{default:r(()=>o[6]||(o[6]=[c("Confirm")])),_:1},8,["disabled"])]),_:1},8,["onConfirmed"])):p("",!0),e.recoveryCodes.length>0&&!e.confirming?(n(),u(b,{key:1,onConfirmed:e.regenerateRecoveryCodes},{default:r(()=>[i(m,{class:"me-3"},{default:r(()=>o[7]||(o[7]=[c("Regenerate Recovery Codes")])),_:1})]),_:1},8,["onConfirmed"])):p("",!0),e.recoveryCodes.length===0&&!e.confirming?(n(),u(b,{key:2,onConfirmed:e.showRecoveryCodes},{default:r(()=>[i(m,{class:"me-3"},{default:r(()=>o[8]||(o[8]=[c("Show Recovery Codes")])),_:1})]),_:1},8,["onConfirmed"])):p("",!0),i(b,{onConfirmed:e.disableTwoFactorAuthentication},{default:r(()=>[i(m,{color:"error",disabled:e.disabling},{default:r(()=>o[9]||(o[9]=[c("Disable")])),_:1},8,["disabled"])]),_:1},8,["onConfirmed"])],64)):(n(),u(b,{key:0,onConfirmed:e.enableTwoFactorAuthentication},{default:r(()=>[i(m,{color:"primary",variant:"elevated",disabled:e.enabling},{default:r(()=>o[5]||(o[5]=[c("Enable")])),_:1},8,["disabled"])]),_:1},8,["onConfirmed"]))])]),_:1})}const Ie=N(ue,[["render",ye]]);export{Ie as default};
